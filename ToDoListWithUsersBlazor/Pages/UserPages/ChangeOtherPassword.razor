@using DataLibrary.Models;
@using ToDoListWithUsersBlazor.Services;
@inject UserServiceUi userService;
@inject NavigationManager navigationManager;

<p class="text-danger">@ErrorMessage</p>
<EditForm Model="@User" OnSubmit="@EditPassword" autocomplete="off">
    <div class="form-group row d-flex align-items-center">
        <div class="form-group col">
            <InputText placeholder="New password..." type="password" id="password" @bind-Value="User.Password" class="form-control"/>
        </div>
        <div class="form-group col">
            <InputText placeholder="Confirm password..." type="password" id="confirmPassword" @bind-Value="User.ConfirmPassword" class="form-control" />
        </div>
        <div class="form-group col">
            <button class="btn btn-success oi oi-check"></button>
            <button type="reset" @onclick="@(() => OnToggleConfirmPassword.InvokeAsync())" class="btn btn-danger oi oi-x"></button>
        </div>
    </div>
</EditForm>
@code {
    [Parameter]
    public EventCallback<UserModel> OnToggleConfirmPassword { get; set; }
    [Parameter]
    public UserModel User { get; set; }
    public string ErrorMessage { get; set; } = "";

    protected override async Task OnInitializedAsync()
    {
        User.Password = ""; //Någon sorts bugg i programmet? Sätter password till null men ändå finns ett "Securely generated password" kvar i fältet med id "password" uppa i edit form. Det fungerar bra på chrome men inte på firefox
    }

    public async Task EditPassword()
    {
        try
        {
            User = await userService.ChangeOtherPassword(User);
            await OnToggleConfirmPassword.InvokeAsync();
        }
        catch (Exception)
        {
            
            ErrorMessage = "Passwords dont match";
        }
        
    }
}
